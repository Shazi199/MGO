#include("../common/_layout.html")
#include("../common/_navbar.html")
#@layout()

#define content()
	#@navbar("stage")
	<div class="container mainContainer">
		<div class="panel panel-danger">
		  <div class="panel-heading">敌方</div>
		  <table class="table table-hover" id="enemyUnits">
		  </table>
		</div>
		
		<div class="panel panel-primary">
		  <div class="panel-heading">我方</div>
		  <table class="table table-hover" id="friendUnits">
		  </table>
		</div>
		
		<div class="panel panel-success">
		  <div class="panel-heading">指令卡</div>
		  <div class="panel-body" id="commandCards"></div>
		</div>
		
		<div class="panel panel-info">
		  <div class="panel-heading">战斗记录</div>
		  <div class="panel-body" id="battleLog">
		  	<p>A->B</p>
		  </div>
		</div>
	</div>
	<script type="text/javascript">
		var enemyUnits = null;
		var friendUnits = null;
		var commandCards = null;
		
		$(function(){
			getEnemiesInfo();
			getFriendsInfo(getCardsInfo);
		});
		
		function getEnemiesInfo() {
			$.post("battle/getEnemiesInfo",function(data){
				enemyUnits = data;
				for(var i=0;i<data.length;i++){
					$("#enemyUnits").append(createEnemyRow(data[i]));
				}
			},"json");
		}
		
		function getFriendsInfo(callback) {
			$.post("battle/getFriendsInfo",function(data){
				friendUnits = data;
				for(var i=0;i<data.length;i++){
					$("#friendUnits").append(createFriendRow(data[i]));
				}
				if(callback!=null){
					callback();
				}
			},"json");
		}
		
		function getCardsInfo() {
			$.post("battle/getCardsInfo",function(data){
				commandCards = data;
				for(var i=0;i<data.length;i++){
					$("#commandCards").append(createCardsButton(data[i]));
				}
			},"json");
		}
		
		function createEnemyRow(data) {
			var cardInfo = SERVENT_DB[data.sid];
			var row = "<tr id=\"enemy_1\">";
			row += "<td>"+cardInfo.name+"</td>";
			row += "<td>Lv."+data.level+"</td>";
			row += "<td>"+CLASS_DB[data.type]+"</td>";
			row += "<td>"+data.hp+"/"+data.maxhp+"</td>";
			row += "<td>"+data.np+"/"+data.maxnp+"</td>";
			row += "</tr>";
			return row;
		}
		
		function createFriendRow(data) {
			var cardInfo = SERVENT_DB[data.sid];
			var row = "<tr id=\"friend_1\">";
			row += "<td>"+cardInfo.name+"</td>";
			row += "<td>Lv."+data.level+"</td>";
			row += "<td>"+CLASS_DB[data.type]+"</td>";
			row += "<td>"+data.hp+"/"+data.maxhp+"</td>";
			row += "<td>"+data.np+"%</td>";
			row += "</tr>";
			return row;
		}
		
		function createCardsButton(data) {
			var friend = friendUnits[data.unitIndex];
			var friendInfo = SERVENT_DB[friend.sid];
			var btn = "<button class=\"btn btn-lg "+btnColor(data.type)+"\">";
			btn += friendInfo.name;
			btn += "</button>";
			return btn;
		}
		
		function btnColor(type){
			switch(type){
				case 1:
					return "btn-danger";
				case 2:
					return "btn-primary";
				case 3:
					return "btn-success";
				default:
					return "btn-default";
			}
		}
	</script>
	<script src="js/db.js"></script>
#end

#define css()
<style type="text/css">
.mainContainer {
	margin-top:25px;
}
</style>
#end